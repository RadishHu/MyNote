# Zookeeper集群采用单数的原因

搭建zk集群，通常由2n+1台servers组成，集群采用单数的原因：

- 降低成本

  zk集群只要半数以上servers存活时，才能正常运行，从容错的角度考虑：3台服务器和4台服务器都最多允许1台服务器挂掉，5台服务器和6台服务器都允许最多2台服务器挂掉，2n+1可以降低成本

- 防脑裂

  - Majority Qunroms

    zk默认采用Majority Qunroms来支持Leader选举，Majortiy Qunroms的作用：

    集群中以最少的节点数用来选举Leader，保证集群可用

    通知客户端数据已经安全保存前，集群中最少数量的节点数已保存了该数据。一旦这些节点保存了该数据，客户端将被通知已经安全保存了

  - Split-Brain(脑裂)问题

    一个集群发生网络故障，很可能出现一个集群分成了两个部分，而这两个部分都不知道对方是否存活，不知道到底是网络问题还是机器down了，所以这 两部分都要选举一个leader，而一旦两部分都选出leader，并且网络又恢复了，那么就会出现两个Brain的情况，整个集群的行为就会不一致

  - 防止脑裂出现

    Quorums，只有集群中超过半数节点投票才能选出leader，确保leader唯一性，要么选出一个，要么失败

    采用Redumdant communications，冗余通信的方式，集群中采用多种通信方式，防止一种通信方式失败导致集群中的节点无法通信 

节点配置成奇数的集群容错性更高